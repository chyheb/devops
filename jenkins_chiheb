pipeline{

   agent any
        tools {
     jdk 'JAVA_HOME'
     maven 'M2_HOME'

  }
        stages{
			stage('GIT Checkout') {
				steps {
                echo 'Pulling code from Git'
                git branch: 'main', 
                url: 'https://github.com/chyheb/devops.git'
				}
			}

             stage('Building JAR') {
            steps {
                echo 'Building with Maven'
                sh 'mvn clean install -DskipTests'
				}
			}
            stage('JUnit/Mockito'){
                steps {
                echo 'Testing Facture Services'
                sh 'mvn test'
            }
            }
            stage("SonarQube") {
                       steps {
						echo 'SonarQube'
                         withSonarQubeEnv('sonar') {
                           sh 'mvn clean -DskipTests package sonar:sonar'
                         }
                       }
                     }
             stage('Publish to Nexus') {
            steps {


  sh 'mvn clean package deploy:deploy-file -DgroupId=tn.esprit -DartifactId=ExamThourayaS2 -Dversion=1.0 -DgeneratePom=true -Dpackaging=jar -DrepositoryId=deploymentRepo -Durl=http://localhost:8081/repository/maven-releases/ -Dfile=target/ExamThourayaS2-1.0.jar'


            }
        }
	}			
}
